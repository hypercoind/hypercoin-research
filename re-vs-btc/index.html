<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real Estate vs Portfolio Investment Comparison</title>
    
    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline'; img-src 'self' data:; connect-src 'self'; frame-ancestors 'none'; base-uri 'self'; form-action 'self';">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    <meta http-equiv="Permissions-Policy" content="camera=(), microphone=(), geolocation=(), payment=()">
    
    <link rel="icon" type="image/jpeg" href="../images/hypercoin.info.jpg">
    <link rel="apple-touch-icon" href="../images/hypercoin.info.jpg">
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="calculator.css">
</head>
<body>
    <div class="site-header">
        <div class="site-header-content">
            <a href="../index.html" class="site-logo">hypercoin.info</a>
            <button class="theme-toggle" id="theme-toggle">☀️ Light</button>
        </div>
    </div>
    
    <div class="container">
        <header>
            <h1>Real Estate or BTC?</h1>
            <p>Compare real estate investments with volatility-matched Bitcoin portfolios using US median market data</p>
        </header>

        <div class="input-section">
            <div class="real-estate-inputs">
                <h2>Real Estate Investment</h2>
                <div class="input-group">
                    <label for="property-price">Property Price ($)</label>
                    <input type="number" id="property-price" value="435000" min="0">
                </div>
                <div class="input-group">
                    <label for="down-payment">Down Payment ($)</label>
                    <input type="number" id="down-payment" value="87000" min="0">
                </div>
                <div class="input-group">
                    <label for="interest-rate">Mortgage Interest Rate (%)</label>
                    <input type="number" id="interest-rate" value="6.7" min="0" max="20" step="0.1">
                </div>
                <div class="input-group">
                    <label for="rental-yield">Annual Rental Yield (%)</label>
                    <input type="number" id="rental-yield" value="0" min="0" max="20" step="0.1">
                </div>
                <div class="input-group">
                    <label for="property-appreciation">Annual Property Appreciation (%)</label>
                    <input type="number" id="property-appreciation" value="4" min="0" max="20" step="0.1">
                </div>
                <div class="input-group">
                    <label for="maintenance-costs">Annual Maintenance/Costs (%)</label>
                    <input type="number" id="maintenance-costs" value="2" min="0" max="10" step="0.1">
                </div>
                <div class="input-group">
                    <label for="hoa-fee">Monthly HOA Fee ($)</label>
                    <input type="number" id="hoa-fee" value="0" min="0">
                </div>
            </div>

            <div class="portfolio-inputs">
                <h2>Investment Portfolio</h2>
                <div class="input-group">
                    <label for="initial-investment">Initial Investment ($)</label>
                    <input type="number" id="initial-investment" value="87000" min="0">
                </div>
                <div class="allocation-inputs">
                    <h3>Portfolio Allocation (%)</h3>
                    <div class="input-group">
                        <label for="btc-allocation">Bitcoin ETF</label>
                        <input type="number" id="btc-allocation" value="20" min="0" max="100">
                    </div>
                    <div class="input-group">
                        <label for="voo-allocation">VOO (S&P 500)</label>
                        <input type="number" id="voo-allocation" value="20" min="0" max="100">
                    </div>
                    <div class="input-group">
                        <label for="treasury-allocation">Treasuries</label>
                        <input type="number" id="treasury-allocation" value="20" min="0" max="100">
                    </div>
                    <div class="input-group">
                        <label for="strc-allocation">STRC (Strategy Corp)</label>
                        <input type="number" id="strc-allocation" value="20" min="0" max="100">
                    </div>
                    <div class="input-group">
                        <label for="hysa-allocation">High Yield Savings</label>
                        <input type="number" id="hysa-allocation" value="20" min="0" max="100">
                    </div>
                </div>
            </div>

            <div class="rent-inputs">
                <h2>Rent Compare</h2>
                <div class="input-group">
                    <label for="current-rent">Current Monthly Rent ($)</label>
                    <input type="number" id="current-rent" value="2075" min="0">
                </div>
                <div class="input-group">
                    <label for="rent-inflation">Annual Rent Inflation (%)</label>
                    <input type="number" id="rent-inflation" value="3.5" min="0" max="20" step="0.1">
                </div>
            </div>

            <div class="common-inputs">
                <h2>Analysis Parameters</h2>
                <div class="time-horizon-group">
                    <div class="input-group">
                        <label for="time-horizon">Time Horizon (years)</label>
                        <input type="number" id="time-horizon" value="10" min="1" max="50">
                    </div>
                    <button id="reset-btn" class="reset-btn">Reset to Defaults</button>
                </div>
            </div>
        </div>

        <div class="controls">
            <button id="calculate-btn">Calculate & Compare</button>
        </div>

        <div class="results-section" id="results" style="display: none;">
            <h2>Investment Comparison Results</h2>
            <div class="results-grid">
                <div class="result-card real-estate">
                    <h3>Real Estate Investment</h3>
                    <div class="result-item">
                        <span class="label">Total Investment:</span>
                        <span class="value" id="re-total-investment">$0</span>
                    </div>
                    <div class="result-item">
                        <span class="label">Final Property Value:</span>
                        <span class="value" id="re-property-value">$0</span>
                    </div>
                    <div class="result-item">
                        <span class="label">Total Rental Income:</span>
                        <span class="value" id="re-rental-income">$0</span>
                    </div>
                    <div class="result-item">
                        <span class="label">Net Worth:</span>
                        <span class="value" id="re-net-worth">$0</span>
                    </div>
                    <div class="result-item">
                        <span class="label">Annual Return:</span>
                        <span class="value" id="re-annual-return">0%</span>
                    </div>
                    <div class="result-item">
                        <span class="label">Monthly Payment:</span>
                        <span class="value" id="re-monthly-payment">$0</span>
                    </div>
                    
                    <button class="expand-details-btn" onclick="togglePaymentDetails()">View Payment Breakdown</button>
                    
                    <div class="payment-details" id="payment-details" style="display: none;">
                        <div class="result-item">
                            <span class="label">Principal & Interest:</span>
                            <span class="value" id="re-principal-interest">$0</span>
                        </div>
                        <div class="result-item">
                            <span class="label">Property Tax:</span>
                            <span class="value" id="re-property-tax">$0</span>
                        </div>
                        <div class="result-item">
                            <span class="label">Home Insurance:</span>
                            <span class="value" id="re-home-insurance">$0</span>
                        </div>
                        <div class="result-item">
                            <span class="label">PMI:</span>
                            <span class="value" id="re-pmi">$0</span>
                        </div>
                        <div class="result-item">
                            <span class="label">HOA Fee:</span>
                            <span class="value" id="re-hoa-fee">$0</span>
                        </div>
                    </div>
                    
                    <div class="result-item">
                        <span class="label">Investment Volatility:</span>
                        <span class="value" id="re-volatility">0%</span>
                    </div>
                </div>

                <div class="result-card bitcoin-savings">
                    <h3>Bitcoin Savings Strategy</h3>
                    <div class="result-item">
                        <span class="label">Average Monthly BTC Investment:</span>
                        <span class="value" id="btc-monthly-savings">$0</span>
                    </div>
                    <div class="result-item">
                        <span class="label">Total BTC Investment:</span>
                        <span class="value" id="btc-total-investment">$0</span>
                    </div>
                    <div class="result-item">
                        <span class="label">Final BTC Portfolio Value:</span>
                        <span class="value" id="btc-final-value">$0</span>
                    </div>
                    <div class="result-item">
                        <span class="label">BTC Portfolio Gain:</span>
                        <span class="value" id="btc-gain">$0</span>
                    </div>
                    <div class="result-item">
                        <span class="label">BTC Annual Return:</span>
                        <span class="value" id="btc-annual-return">0%</span>
                    </div>
                </div>

                <div class="result-card portfolio">
                    <h3>Investment Portfolio</h3>
                    <div class="result-item">
                        <span class="label">Total Investment:</span>
                        <span class="value" id="portfolio-total-investment">$0</span>
                    </div>
                    <div class="result-item">
                        <span class="label">Final Portfolio Value:</span>
                        <span class="value" id="portfolio-value">$0</span>
                    </div>
                    <div class="result-item">
                        <span class="label">Net Gain:</span>
                        <span class="value" id="portfolio-gain">$0</span>
                    </div>
                    <div class="result-item">
                        <span class="label">Annual Return:</span>
                        <span class="value" id="portfolio-annual-return">0%</span>
                    </div>
                    <div class="result-item">
                        <span class="label">Portfolio Volatility:</span>
                        <span class="value" id="portfolio-volatility">0%</span>
                    </div>
                    <div class="result-item">
                        <span class="label">Optimized BTC Allocation:</span>
                        <span class="value" id="optimized-btc-allocation">0%</span>
                    </div>
                </div>
            </div>


            <div class="comparison-summary">
                <h3>Comparison Summary</h3>
                <div class="winner" id="winner-summary"></div>
                <div class="difference" id="difference-summary"></div>
                <div class="savings-summary" id="savings-summary"></div>
            </div>

            <div class="chart-container">
                <canvas id="comparison-chart" width="800" height="400"></canvas>
            </div>
        </div>

        <div class="disclaimer-section">
            <h3>⚠️ Disclaimer</h3>
            <p><strong> Educational tool only. </strong> Not financial advice. </p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js" 
            integrity="sha512-6HrPqAvK+lZElIZ4mZ64fyxIBTsaX5zAFZg2V/2WT+iKPrFzTzvx6QAsLW2OaLwobhMYBog/+bvmIEEGXi0p1w==" 
            crossorigin="anonymous" 
            referrerpolicy="no-referrer"></script>
    <script>
        // Theme Management - Initialize on page load
        const themeToggle = document.getElementById('theme-toggle');
        const body = document.body;
        
        // Function to apply theme securely
        function applyTheme(theme) {
            if (theme === 'light') {
                body.setAttribute('data-theme', 'light');
                themeToggle.textContent = '🌙 Dark';
            } else {
                body.setAttribute('data-theme', 'dark');
                themeToggle.textContent = '☀️ Light';
            }
        }
        
        // Secure localStorage for theme validation
        function getSecureTheme() {
            try {
                const theme = localStorage.getItem('theme');
                if (theme && ['light', 'dark'].includes(theme)) {
                    return theme;
                }
                if (theme) {
                    console.warn('Invalid theme value, removing');
                    localStorage.removeItem('theme');
                }
                return null;
            } catch (error) {
                console.error('localStorage access error:', error.message);
                return null;
            }
        }

        function setSecureTheme(theme) {
            if (!['light', 'dark'].includes(theme)) {
                console.warn('Invalid theme value:', theme);
                return false;
            }
            try {
                localStorage.setItem('theme', theme);
                return true;
            } catch (error) {
                console.error('localStorage write error:', error.message);
                return false;
            }
        }

        // Check for saved theme preference or default to dark mode
        const savedTheme = getSecureTheme();
        if (savedTheme) {
            applyTheme(savedTheme);
        } else {
            applyTheme('dark');
        }
        
        // Theme toggle functionality
        themeToggle.addEventListener('click', function() {
            const currentTheme = body.getAttribute('data-theme');
            
            if (currentTheme === 'light') {
                applyTheme('dark');
                setSecureTheme('dark');
            } else {
                applyTheme('light');
                setSecureTheme('light');
            }
            
            // Update chart colors if calculator is loaded and chart exists
            if (window.calculator && window.calculator.chart) {
                window.calculator.updateChartColors();
            }
        });
        
        // Handle theme from URL parameter (for carrying over from main page)
        const urlParams = new URLSearchParams(window.location.search);
        const themeParam = urlParams.get('theme');
        if (themeParam && (themeParam === 'light' || themeParam === 'dark')) {
            applyTheme(themeParam);
            localStorage.setItem('theme', themeParam);
            // Clean up URL by removing the theme parameter
            const newUrl = window.location.href.split('?')[0];
            window.history.replaceState({}, document.title, newUrl);
        }
        
        // Toggle payment details function
        function togglePaymentDetails() {
            const details = document.getElementById('payment-details');
            const button = document.querySelector('.expand-details-btn');
            
            if (details.style.display === 'none' || details.style.display === '') {
                details.style.display = 'block';
                button.textContent = 'Hide Payment Breakdown';
            } else {
                details.style.display = 'none';
                button.textContent = 'View Payment Breakdown';
            }
        }
        
        // Make function globally accessible
        window.togglePaymentDetails = togglePaymentDetails;

        // Add scroll effect to site header (navigation bar)
        window.addEventListener("scroll", () => {
            const siteHeader = document.querySelector(".site-header");
            if (window.scrollY > 100) {
                siteHeader.style.background = "rgba(13, 17, 23, 0.95)";
                siteHeader.style.backdropFilter = "blur(10px)";
            } else {
                siteHeader.style.background = "transparent";
                siteHeader.style.backdropFilter = "blur(10px)";
            }
        });

        // Intersection Observer for animations
        const observerOptions = {
            threshold: 0.1,
            rootMargin: "0px 0px -50px 0px",
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach((entry) => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = "1";
                    entry.target.style.transform = "translateY(0)";
                }
            });
        }, observerOptions);

        // Hide all content except h1 headers initially
        document.querySelectorAll(".real-estate-inputs, .portfolio-inputs, .rent-inputs, .common-inputs, .help-section, .results-section, .controls, header p").forEach((element, index) => {
            element.style.opacity = "0";
            element.style.transform = "translateY(30px)";
            element.style.transition = `opacity 0.6s ease ${index * 0.1}s, transform 0.6s ease ${index * 0.1}s`;
            observer.observe(element);
        });
    </script>
    <script src="script.js"></script>
</body>
</html>